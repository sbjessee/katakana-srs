<div class="dashboard-container">
  <h1>Dashboard</h1>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading">
    <div class="spinner"></div>
    <p>Loading dashboard...</p>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!isLoading && stats" class="dashboard-content">
    <!-- Hero Sections Grid -->
    <div class="hero-grid">
      <!-- Lessons Section -->
      <div class="hero-section lessons" [class.available]="stats.lessons_available > 0" [class.empty]="stats.lessons_available === 0">
        <div *ngIf="stats.lessons_available > 0">
          <h2>{{ stats.lessons_available }} Lessons Available!</h2>
          <p>Learn new katakana characters</p>
          <a routerLink="/lessons" class="btn btn-lg btn-primary">Start Lesson</a>
        </div>
        <div *ngIf="stats.lessons_available === 0">
          <h2>No Lessons Available</h2>
          <p>You've completed all lessons!</p>
        </div>
      </div>

      <!-- Reviews Section -->
      <div class="hero-section reviews" [class.available]="stats.reviews_due_now > 0" [class.empty]="stats.reviews_due_now === 0">
        <div *ngIf="stats.reviews_due_now > 0">
          <h2>{{ stats.reviews_due_now }} Reviews Available!</h2>
          <p>Practice what you've learned</p>
          <a routerLink="/review" class="btn btn-lg btn-primary">Start Reviews</a>
        </div>
        <div *ngIf="stats.reviews_due_now === 0">
          <h2>0 Reviews Left</h2>
          <p>You're done for now!</p>
        </div>
      </div>
    </div>

    <!-- Stats Grid -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-value">{{ stats.total_items }}</div>
        <div class="stat-label">Total Items</div>
      </div>

      <div class="stat-card">
        <div class="stat-value">{{ stats.reviews_due_today }}</div>
        <div class="stat-label">Due Today</div>
      </div>

      <div class="stat-card">
        <div class="stat-value">{{ stats.accuracy_rate }}%</div>
        <div class="stat-label">Accuracy</div>
      </div>
    </div>

    <!-- Two Column Grid: Stage Distribution and Upcoming Reviews -->
    <div class="dashboard-grid">
      <!-- SRS Stage Distribution -->
      <div class="section stage-distribution-section">
        <h3>SRS Stage Distribution</h3>
        <div class="stage-histogram">
          <div *ngFor="let stage of getStageEntries()" class="histogram-bar">
            <div class="bar-label">{{ getStageLabelShort(stage.name) }}</div>
            <div class="bar-container">
              <div
                class="bar-fill"
                [style.width.%]="stats.total_items > 0 ? (stage.count / stats.total_items) * 100 : 0"
                [style.background-color]="stage.color"
              ></div>
            </div>
            <div class="bar-count">{{ stage.count }}</div>
          </div>
        </div>
      </div>

      <!-- Upcoming Reviews -->
      <div class="section upcoming-reviews" *ngIf="upcomingReviews.length > 0">
      <h3>Upcoming Reviews</h3>
      <div class="upcoming-header">
        <div class="upcoming-title">
          <span class="next-24">Next 24 Hours:</span>
          <span class="next-24-count">+{{ next24HoursCount }} Items</span>
        </div>
      </div>

      <div class="upcoming-list">
        <!-- Daily view -->
        <div *ngIf="!expandedDate">
          <div *ngFor="let upcoming of upcomingReviews" class="upcoming-day-item" (click)="toggleDayExpansion(upcoming.date)">
            <div class="day-name">{{ formatDayName(upcoming.date) }}</div>
            <div class="day-bar-container">
              <div
                class="day-bar"
                [style.width.%]="(upcoming.new_count / getMaxNewCount()) * 100"
              ></div>
            </div>
            <div class="day-new-count">(+{{ upcoming.new_count }})</div>
            <div class="day-total-count">{{ stats.reviews_due_now + upcoming.count }}</div>
            <div class="day-chevron">›</div>
          </div>
        </div>

        <!-- Hourly view (when day is expanded) -->
        <div *ngIf="expandedDate" class="hourly-view">
          <div class="hourly-header" (click)="toggleDayExpansion(expandedDate)">
            <span class="back-chevron">‹</span>
            <span class="day-title">{{ formatDate(expandedDate) }}</span>
            <span class="day-summary">(+{{ getExpandedDayNewCount() }}) {{ stats.reviews_due_now + getExpandedDayTotalCount() }}</span>
          </div>
          <div class="hourly-list">
            <div *ngFor="let hourly of hourlyReviews" class="hourly-item">
              <div class="hourly-time">{{ formatHour(hourly.hour) }}</div>
              <div class="hourly-bar-container">
                <div
                  class="hourly-bar"
                  [style.width.%]="(hourly.new_count / getMaxHourlyNewCount()) * 100"
                ></div>
              </div>
              <div class="hourly-new-count">(+{{ hourly.new_count }})</div>
              <div class="hourly-total-count">{{ stats.reviews_due_now + hourly.count }}</div>
            </div>
          </div>
        </div>
      </div>
      </div>
    </div>
  </div>
</div>
